speshiy/V-K-Alcohol-Excise-Parse:
  # This Basic Distelli Manifest assumes the following
  # has been provisioned on the destination deploy server:
  #
  # OS: CentOS7
  # Installed Packages:
  #   golang >= go1.1   [sudo yum install golang]
  #
  Env:
    - SCT: unknown

  PreInstall:
    - if [[ "$SCT" == 'unknown' ]]; then
    -   echo "SCT is not configured correctly."
    -   echo "Exiting..."
    -   exit 1
    - fi

  PostInstall:
    - echo "Begin Post Install"
    - export GOPATH=/home/distelli/go
    - sudo rm -rf /home/distelli/go/src/github.com/speshiy/V-K-Alcohol-Excise-Parse
    - sudo mkdir -p /home/distelli/go/src/github.com/speshiy/V-K-Alcohol-Excise-Parse
    - sudo cp -r * /home/distelli/go/src/github.com/speshiy/V-K-Alcohol-Excise-Parse
    - sudo rm -rf /home/distelli/go/bin/tuvis_sale_script_server
    - sudo mkdir -p /home/distelli/go/bin
    - sudo chown -R distelli:distelli /home/distelli/go
    - sudo mkdir -p /var/www/tuvis/frontend
    - sudo rm -rf /var/www/tuvis/frontend/*
    - sudo cp -r frontend/* /var/www/tuvis/frontend
    - echo "Building app"
    - cd /home/distelli/go/src/github.com/speshiy/V-K-Alcohol-Excise-Parse
    - go build -o $GOPATH/bin/tuvis_sale_script_server main.go
    - echo "Delete sources"
    - sudo rm -rf /home/distelli/go/src
    - echo "Delete sources from distelli _apps"
    - find /distelli/ -type f -name '*.go' -delete
    - find /distelli/ -type f -name '*.yml' -delete
    - find /distelli/ -type f -name '*.lock' -delete
    - find /distelli/ -type f -name '*.toml' -delete
    - find /distelli/ -type d -empty -delete
    
  Exec:
    - echo "Begin Exec" 
    - exec sudo /home/distelli/go/bin/tuvis_sale_script_server -release=true -ssl=true -sct=$SCT

  PkgInclude:
    - '*'
    
